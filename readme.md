# What dis?
Nginx Docker image that allows your SPA to use inline styles and enable CSP.

(In this case I targeted JSS/Material UI but this could be applied to any library.)

# What problem does this solve for AlphaPoint and digitizer-ui?
[CSP](https://www.w3.org/TR/CSP3/) is a great way to reduce XSS vulnerabilities in webapps by disallowing inline and external scripts from untrusted sources. Many [fintech](https://www.coinbase.com/) [sites](https://www.binance.com) are already [using](https://www.kraken.com/) it.

For React SPAs, sometimes certain [React](http://cssinjs.org) [libraries](https://github.com/wwayne/react-tooltip) depend on injecting styles into the DOM at runtime. This poses a problem because CSP considers this an XSS attack vector and blocks this inline injection by default.

Fortunately there is a technique to keep the best of both worlds. CSP can stay enabled, with our own style injection allowed, but while disallowing inline & untrusted external scripts: nonces.

Nonces must be new on each page load, and are ideally generated by the web server. For [material-ui](http://material-ui.com) apps (which this project targets) the nonce must both be presented as an HTTP header, and additionally injected into a <meta> tag.

This project starts from a minimal/conservative [fork](https://github.com/fholzer/docker-nginx-brotli) of Nginx's official upstream [Docker](https://hub.docker.com/_/nginx/) stable image. The fork adds Brotli support directly from Google's repo to enable best-in-class compression.

As a final adjustment we conservatively add the minimum necessary modules to handle secure nonce injection. By using `set_secure_random_alphanum` [directive](https://www.nginx.com/resources/wiki/modules/set_misc/#set-secure-random-alphanum), and the regular old `sub_filter` directive, we can inject a secure nonce on every page reload, in compliance with the CSP [spec](https://www.w3.org/TR/CSP3)

Future work: consider GitHub's [post about CSP](https://githubengineering.com/githubs-csp-journey/) and see what if anything can be brought into AlphaPoint's stance.

# What is this?
This project is based on Alpine Linux, the official nginx image and an nginx module that provides static and dynamic brotli compression. Brotli is built by Google. Originally this image used Google's nginx brotli module, though as it is no longer maintained I switched to [eustas' fork](https://github.com/eustas/ngx_brotli).

# How to use this image
As this project is based on the official [nginx image](https://hub.docker.com/_/nginx/) look for instructions there. In addition to the standard configuration directives, you'll be able to use the brotli module specific ones, see [here for official documentation](https://github.com/eustas/ngx_brotli#configuration-directives)
