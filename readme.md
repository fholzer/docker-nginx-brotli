# Wat dis?
Minimally modified Docker image, based on upstream nginx that allows your webapp to benefit from brotli & CSP.

Originally the CSP was intended to protect a React app but this could be applied to any webapp.

# What problem does this solve?
[CSP](https://www.w3.org/TR/CSP3/) is a great way to reduce XSS vulnerabilities in webapps by disallowing certain kinds of content from untrusted sources. Many [fintech](https://www.coinbase.com/) and [developer](https://www.github.com/) [sites](https://www.binance.com) have been [using](https://www.kraken.com/) it for a while.

For React SPAs, sometimes certain [React](http://cssinjs.org) [libraries](https://github.com/wwayne/react-tooltip) depend on injecting styles into the DOM at runtime. This poses a problem because CSP considers this an attack vector and blocks this inline injection by default.

Fortunately there is a technique that utilizes server provided nonces to keep the best of both worlds. CSP can stay enabled, with our own style injection allowed, but disallowing inline & untrusted external scripts.

Nonces must be new on each request (page load), and are ideally generated by the web server. For [material-ui](http://material-ui.com) apps (which this project originally targeted) the nonce must both be presented as an HTTP header, and additionally injected into a <meta> tag.

This project starts from a minimal/conservative [fork](https://github.com/fholzer/docker-nginx-brotli) of Nginx's official upstream [Docker](https://hub.docker.com/_/nginx/) stable image. The fork adds Brotli support directly from Google's repo to enable best-in-class compression.

As a final adjustment we conservatively add the minimum necessary modules to handle secure nonce injection. By using `set_secure_random_alphanum` [directive](https://www.nginx.com/resources/wiki/modules/set_misc/#set-secure-random-alphanum), and the regular old `sub_filter` directive, we can inject a secure nonce on every page reload, in compliance with the CSP [spec](https://www.w3.org/TR/CSP3)


# What is this?
This project is based on Alpine Linux, the official nginx image and an nginx module that provides static and dynamic brotli compression. [Brotli](https://github.com/google/brotli) and the [nginx brotli module ](https://github.com/google/ngx_brotli) are built by Google.

# How to use this image
As this project is based on the official [nginx image](https://hub.docker.com/_/nginx/) look for instructions there. In addition to the standard configuration directives, you'll be able to use the brotli module specific ones, see [here for official documentation](https://github.com/google/ngx_brotli#configuration-directives)
