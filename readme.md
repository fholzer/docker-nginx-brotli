# What problem does this solve for React apps?
[CSP](https://www.w3.org/TR/CSP3/) is a great way to reduce XSS vulnerabilities in webapps by disallowing inline and external scripts from untrusted sources. Typically enabling CSP means you should move your trusted scripts to external files, and this is generally the default with e.g. create-react-app apps.

However in some cases, certain React libraries [1](http://cssinjs.org) [2](https://github.com/wwayne/react-tooltip) depend on injecting styles into the DOM at runtime. This poses a problem because CSP considers this an XSS attack vector and blocks this by default.

Fortunately there is a technique to keep the best of both worlds: CSP enabled, our own style injection is allowed, while disallowing inline & untrusted external scripts: nonces.

Nonces must be new on each page load, and are ideally generated by the web server. For [material-ui](http://material-ui.com) apps (which this project targets) the nonce must both be presented as an HTTP header, and additionally injected into a <meta> tag.

We start with the upstream nginx, enable brotli support for best-in-class compression, and conservatively add the minimum necessary modules to handle secure nonce injection. By using `set_secure_random_alphanum` [directive](https://www.nginx.com/resources/wiki/modules/set_misc/#set-secure-random-alphanum), and the regular old `sub_filter` directive, we can inject a secure nonce on every page reload, in compliance with the [spec](https://www.w3.org/TR/CSP3)

Future work: consider GitHub's [post about CSP](https://githubengineering.com/githubs-csp-journey/) and see what if anything can be brought into AlphaPoint's stance.

# What is this?
This project is based on Alpine Linux, the official nginx image and an nginx module that provides static and dynamic brotli compression. Brotli is built by Google. Originally this image used Google's nginx brotli module, though as it is no longer maintained I switched to [eustas' fork](https://github.com/eustas/ngx_brotli).

# How to use this image
As this project is based on the official [nginx image](https://hub.docker.com/_/nginx/) look for instructions there. In addition to the standard configuration directives, you'll be able to use the brotli module specific ones, see [here for official documentation](https://github.com/eustas/ngx_brotli#configuration-directives)
